import{Q as de}from"./QPage-Ciq5b9Oz.js";import{as as ie,A as ae,d as N,aM as Y,l as t,ac as p,ab as q,F as m,f as l,n as e,ad as h,P as T,m as n,y as d,ae as x,q as M,U as L,ag as c,ai as A,_ as R,r as G,v as K,Q as H,a8 as te,x as F,a9 as ce,aL as X,o as oe,t as I,b4 as Z,ah as ee,aE as pe,E as ve,V as fe}from"./index-DzM_srFz.js";import{I as me}from"./InnerLoading-DS6JcJwB.js";import{a as k,Q as P,b as S}from"./QItemLabel-BBVA7O39.js";import{Q as j}from"./QExpansionItem-22ChQVvH.js";import{Q as z}from"./QList-Daj5B4BR.js";import{S as O,u as le,a as J}from"./use-quasar-OsAyRxUY.js";import{Q as ye}from"./QSelect-5zrMXQeR.js";import"./QMenu-B6mTulVv.js";import"./format-DPS1XQ7V.js";const be=ie("survey",{state:()=>({survey:null,isPageLoaded:!1}),actions:{async loadPage(){this.survey=await ae.getSurvey(),this.isPageLoaded=!0}}}),W=be,_e={class:"card-container column"},ge=M("p",{class:"card-caption text-uppercase q-pl-md q-mb-sm"},"Базовые данные",-1),ke=M("p",{class:"card-caption q-pl-md q-mt-sm"}," Данные поля нельзя редактировать самостоятельно. ",-1),Ve=M("p",{class:"card-caption text-uppercase q-pl-md q-mt-lg q-mb-sm"}," Дополнительная информация ",-1),qe={key:1,class:"text-center"},Se=N({__name:"SurveyViewMode",props:{modelValue:{type:Boolean},modelModifiers:{}},emits:["update:modelValue"],setup(w){const b=W(),f=Y(w,"modelValue");return(U,v)=>(t(),p("div",_e,[q(b).survey?(t(),p(m,{key:0},[ge,l(z,{class:"bg-secondary border-radius-8 overflow-hidden"},{default:e(()=>[(t(!0),p(m,null,h(q(b).survey.mainFields,(o,a)=>(t(),p(m,{key:o.key},[a?(t(),n(L,{key:0})):x("",!0),o.type!=="groups"?T((t(),n(P,{key:1,clickable:""},{default:e(()=>[l(k,null,{default:e(()=>[l(S,null,{default:e(()=>[d(c(o.label),1)]),_:2},1024),l(S,{caption:""},{default:e(()=>[d(c(q(O)[o.type])+" "+c(o.type==="select"?`(${o.options.join(", ")})`:""),1)]),_:2},1024)]),_:2},1024),l(k,{side:""},{default:e(()=>[d(c(o.type!=="info"&&o.required?"Обязательное":"Необязательное"),1)]),_:2},1024)]),_:2},1024)),[[A]]):x("",!0),o.type==="groups"?(t(),n(j,{key:2,label:o.label,caption:q(O)[o.type],"default-opened":""},{default:e(()=>[(t(!0),p(m,null,h(o.groups,_=>(t(),n(j,{key:_.label,label:_.label,"header-inset-level":.3,"content-inset-level":.6},{default:e(()=>[(t(!0),p(m,null,h(_.fields,s=>(t(),n(P,{key:s.label},{default:e(()=>[l(k,null,{default:e(()=>[l(S,null,{default:e(()=>[d(c(s.label),1)]),_:2},1024),l(S,{caption:""},{default:e(()=>[d(c(q(O)[s.type])+" "+c(s.type==="select"?`(${s.options.join(", ")})`:""),1)]),_:2},1024)]),_:2},1024),l(k,{side:""},{default:e(()=>[d(c(s.type==="info"?s.value:s.required?"Обязательное":"Необязательное"),1)]),_:2},1024)]),_:2},1024))),128))]),_:2},1032,["label"]))),128))]),_:2},1032,["label","caption"])):x("",!0)],64))),128))]),_:1}),ke,q(b).survey.addFields.length>0?(t(),p(m,{key:0},[Ve,l(z,{class:"bg-secondary border-radius-8 overflow-hidden"},{default:e(()=>[(t(!0),p(m,null,h(q(b).survey.addFields,(o,a)=>(t(),p(m,{key:o.key},[a?(t(),n(L,{key:0})):x("",!0),o.type==="groups"?(t(),n(j,{key:1,label:o.label,caption:q(O)[o.type],"default-opened":""},{default:e(()=>[(t(!0),p(m,null,h(o.groups,_=>(t(),n(j,{key:_.label,label:_.label,"header-inset-level":.3,"content-inset-level":.6},{default:e(()=>[(t(!0),p(m,null,h(_.fields,s=>(t(),n(P,{key:s.label},{default:e(()=>[l(k,null,{default:e(()=>[l(S,null,{default:e(()=>[d(c(s.label),1)]),_:2},1024),l(S,{caption:""},{default:e(()=>[d(c(q(O)[s.type])+" "+c(s.type==="select"?`(${s.options.join(", ")})`:""),1)]),_:2},1024)]),_:2},1024),l(k,{side:""},{default:e(()=>[d(c(s.type==="info"?s.value:s.required?"Обязательное":"Необязательное"),1)]),_:2},1024)]),_:2},1024))),128))]),_:2},1032,["label"]))),128))]),_:2},1032,["label","caption"])):T((t(),n(P,{key:2,clickable:""},{default:e(()=>[l(k,null,{default:e(()=>[l(S,null,{default:e(()=>[d(c(o.label),1)]),_:2},1024),l(S,{caption:""},{default:e(()=>[d(c(q(O)[o.type])+" "+c(o.type==="select"?`(${o.options.join(", ")})`:""),1)]),_:2},1024)]),_:2},1024),l(k,{side:""},{default:e(()=>[d(c(o.type==="info"?o.value:o.required?"Обязательное":"Необязательное"),1)]),_:2},1024)]),_:2},1024)),[[A]])],64))),128))]),_:1}),l(z,{class:"card-container q-mt-lg bg-secondary border-radius-8 overflow-hidden"},{default:e(()=>[T((t(),n(P,{onClick:v[0]||(v[0]=o=>f.value=!f.value),class:"flex items-center text-info text-center",clickable:""},{default:e(()=>[l(k,null,{default:e(()=>[d(" Редактировать ")]),_:1})]),_:1})),[[A]])]),_:1})],64)):x("",!0)],64)):(t(),p("h5",qe," Данные анкеты остутствуют или произошла ошибка их получения "))]))}}),he=R(Se,[["__file","SurveyViewMode.vue"]]),xe={class:"card-container bg-dark q-pa-md"},$e=M("h5",{class:"text-center q-mt-xs q-mb-lg"},"Редактирование группы",-1),we={class:"scroll q-mb-lg",style:{"max-height":"calc(100vh - 16rem)"}},Ce=N({__name:"SurveyGroupModal",props:{group:{},onSubmit:{type:Function}},emits:le.emits,setup(w){const b=J(),f=w,{dialogRef:U,onDialogOK:v}=le(),o=G(f.group);function a(){return Date.now().toString()}function _(){o.value.label||(o.value.label="Поле без названия")}function s(){o.value.fields.push({type:"text",key:a(),label:"Поле без названия",required:!1})}function D(y){b.dialog({title:"Удалить поле?",message:"Поле будет удалено без возможности восстановления",persistent:!0,ok:{color:"negative",label:"Удалить"},cancel:{color:"secondary",label:"Отменить"}}).onOk(()=>{o.value.fields.splice(y,1)})}function B(y,g){o.value.fields[g]=y}return(y,g)=>(t(),n(ce,{"no-backdrop-dismiss":!1,ref_key:"dialogRef",ref:U},{default:e(()=>[M("div",xe,[$e,M("div",we,[l(K,{modelValue:o.value.label,"onUpdate:modelValue":g[0]||(g[0]=C=>o.value.label=C),onBlur:g[1]||(g[1]=C=>_()),label:"Название поля",placeholder:"Введите название группы",autofocus:"",outlined:""},null,8,["modelValue"]),(t(!0),p(m,null,h(o.value.fields,(C,Q)=>(t(),n(ne,{key:Q,"model-value":C,"delete-unabled":o.value.fields.length===1,"onUpdate:modelValue":E=>B(E,Q),onOnDelete:E=>D(Q),class:"q-mt-lg","group-unabled":"","is-focused":""},null,8,["model-value","delete-unabled","onUpdate:modelValue","onOnDelete"]))),128))]),l(H,{class:"bg-transparent",flat:""},{default:e(()=>[l(te,{class:"row q-pa-none"},{default:e(()=>[l(F,{onClick:s,color:"secondary","text-color":"info",class:"col border-radius-8",padding:"md lg",style:{"line-height":"21px"},"no-caps":""},{default:e(()=>[d(" Добавить поле ")]),_:1}),l(F,{onClick:q(v),"text-color":"positive",color:"secondary",class:"col border-radius-8",padding:"md lg",style:{"line-height":"21px"},"no-caps":""},{default:e(()=>[d(" Применить ")]),_:1},8,["onClick"])]),_:1})]),_:1})])]),_:1},512))}}),Qe=R(Ce,[["__file","SurveyGroupModal.vue"]]),Fe={class:"row items-center"},Ue={class:"row"},Ee=N({__name:"SurveyEditCard",props:X({deleteUnabled:{type:Boolean,default:!1},groupUnabled:{type:Boolean,default:!1}},{modelValue:{required:!0},modelModifiers:{}}),emits:X(["onDelete"],["update:modelValue"]),setup(w,{emit:b}){const f={text:"Текстовое поле",number:"Числовое поле",select:"Один из списка",time:"Время",info:"Информационное поле",groups:"Группы полей"},U=J(),v=w,o=b,a=Y(w,"modelValue"),_=G(!1);function s(){return v.groupUnabled?Object.entries(f).filter(([u])=>u!=="groups").map(([u,r])=>({value:u,label:r})):Object.entries(f).map(([u,r])=>({value:u,label:r}))}function D(){return Date.now().toString()}function B(){a.value.label||(a.value.label="Поле без названия")}function y(u){return u.type==="groups"||u.type==="info"?!1:u.required}function g(u){return`Вариант ${u+1}`}function C(u,r,i){u[i]=r}function Q(u,r,i){return u.options.filter($=>$===r).length>1&&u.options.findLastIndex($=>$===r)===i}function E(u){U.dialog({component:Qe,componentProps:{group:u}})}function ue(){a.value.type==="groups"&&(a.value.groups.push({label:"Новая группа",fields:[{type:"text",key:D(),label:"Поле без названия",required:!1}]}),E(a.value.groups[a.value.groups.length-1]))}function se(u){U.dialog({title:"Удалить группу?",message:"Группа будет удалена без возможности восстановления",persistent:!0,ok:{color:"negative",label:"Удалить"},cancel:{color:"secondary",label:"Отменить"}}).onOk(()=>{a.value.type==="groups"&&a.value.groups.splice(u,1)})}function re(u){switch(u){case"text":case"number":case"time":{a.value={type:u,key:D(),label:a.value.label,required:y(a.value)};break}case"select":{a.value={type:"select",key:D(),label:a.value.label,options:[g(0)],required:y(a.value)};break}case"info":{a.value={type:"info",label:a.value.label,value:"Без описания"};break}case"groups":{a.value={type:"groups",label:a.value.label,groups:[]};break}}}return oe(()=>{_.value=!0}),(u,r)=>(t(),n(H,{class:"border-radius-8",flat:""},{default:e(()=>[l(I,{class:"row items-center justify-between"},{default:e(()=>[l(K,{modelValue:a.value.label,"onUpdate:modelValue":r[0]||(r[0]=i=>a.value.label=i),onBlur:r[1]||(r[1]=i=>B()),label:"Название поля",placeholder:"Введите название поля",class:"col q-mr-sm",style:{"min-width":"16rem"}},null,8,["modelValue"]),l(ye,{"model-value":a.value.type,"onUpdate:modelValue":r[2]||(r[2]=i=>re(i)),options:s(),label:"Тип поля",class:"col q-ml-sm",style:{"min-width":"16rem"},"map-options":"","emit-value":"",outlined:""},null,8,["model-value","options"])]),_:1}),a.value.type==="select"?(t(),n(I,{key:0,class:"q-pt-none"},{default:e(()=>[(t(!0),p(m,null,h(a.value.options,(i,$)=>(t(),p("div",{key:$,class:"row items-center q-mb-md"},[l(Z,{"model-value":null,val:"",disable:""}),l(K,{"model-value":i,autofocus:_.value,error:Q(a.value,i,$),"onUpdate:modelValue":V=>C(a.value.options,V,$),class:"q-ml-sm col","hide-bottom-space":"",dense:""},null,8,["model-value","autofocus","error","onUpdate:modelValue"]),a.value.options.length>1?(t(),n(F,{key:0,onClick:V=>a.value.options.splice($,1),size:"sm",icon:"close",round:"",flat:""},null,8,["onClick"])):x("",!0)]))),128)),M("div",Fe,[l(Z,{"model-value":null,val:"",disable:""}),l(F,{onClick:r[3]||(r[3]=i=>a.value.options.push(g(a.value.options.length))),color:"primary",padding:"2px sm","no-caps":"",flat:""},{default:e(()=>[d(" Добавить вариант ")]),_:1})])]),_:1})):x("",!0),a.value.type==="info"?(t(),n(I,{key:1,class:"q-pt-none"},{default:e(()=>[l(K,{modelValue:a.value.value,"onUpdate:modelValue":r[4]||(r[4]=i=>a.value.value=i),label:"Текст поля",placeholder:"Заполните поле"},null,8,["modelValue"])]),_:1})):x("",!0),a.value.type==="groups"?(t(),n(I,{key:2,class:"q-py-none"},{default:e(()=>[a.value.groups.length>0?(t(),n(L,{key:0})):x("",!0),l(z,{separator:""},{default:e(()=>[(t(!0),p(m,null,h(a.value.groups,(i,$)=>(t(),n(j,{key:i.label,"header-inset-level":.3,"content-inset-level":.6},{header:e(()=>[l(k,null,{default:e(()=>[l(S,null,{default:e(()=>[d(c(i.label),1)]),_:2},1024)]),_:2},1024),l(k,{side:""},{default:e(()=>[M("div",Ue,[l(F,{onClick:ee(V=>E(i),["stop"]),color:"positive",size:"sm",icon:"edit",round:"",flat:""},null,8,["onClick"]),l(F,{disable:a.value.groups.length===1,onClick:ee(V=>se($),["stop"]),color:"negative",size:"sm",icon:"close",round:"",flat:""},null,8,["disable","onClick"])])]),_:2},1024)]),default:e(()=>[(t(!0),p(m,null,h(i.fields,V=>(t(),n(P,{key:V.label,class:"q-px-lg"},{default:e(()=>[l(k,null,{default:e(()=>[l(S,null,{default:e(()=>[d(c(V.label),1)]),_:2},1024),l(S,{caption:""},{default:e(()=>[d(c(f[V.type])+" "+c(V.type==="select"?`(${V.options.join(", ")})`:""),1)]),_:2},1024)]),_:2},1024),l(k,{side:""},{default:e(()=>[d(c(V.type==="info"?V.value:V.required?"Обязательное":"Необязательное"),1)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024))),128)),l(L),T((t(),n(P,{onClick:ue,class:"flex items-center text-info text-center",clickable:""},{default:e(()=>[l(k,null,{default:e(()=>[d(" Добавить группу ")]),_:1})]),_:1})),[[A]])]),_:1})]),_:1})):x("",!0),l(L,{inset:""}),l(I,{class:"row justify-end"},{default:e(()=>[l(F,{disable:u.deleteUnabled,onClick:r[5]||(r[5]=i=>o("onDelete")),color:"negative",icon:"delete",round:"",flat:""},null,8,["disable"]),a.value.type!=="groups"&&a.value.type!=="info"?(t(),p(m,{key:0},[l(L,{vertical:"",spaced:""}),l(pe,{modelValue:a.value.required,"onUpdate:modelValue":r[6]||(r[6]=i=>a.value.required=i),label:"Обязательное поле","left-label":"",dense:""},null,8,["modelValue"])],64)):x("",!0)]),_:1})]),_:1}))}}),ne=R(Ee,[["__scopeId","data-v-143e26f2"],["__file","SurveyEditCard.vue"]]),Me={class:"card-container column q-pa-md"},De=N({__name:"SurveyEditMode",props:{modelValue:{type:Boolean},modelModifiers:{}},emits:["update:modelValue"],setup(w){const b=J(),f=W(),U=Y(w,"modelValue"),v=G(f.survey?.addFields||[]),o=G(!1);function a(){return Date.now().toString()}function _(){v.value&&v.value.push({type:"text",key:a(),label:"Поле без названия",required:!1})}function s(y){b.dialog({title:"Удалить поле?",message:"Поле будет удалено без возможности восстановления",persistent:!0,ok:{color:"negative",label:"Удалить"},cancel:{color:"secondary",label:"Отменить"}}).onOk(()=>{v.value&&v.value.splice(y,1)})}function D(y,g){v.value[g]=y}async function B(){o.value=!0;const y=await ae.updateSurvey({addFields:v.value});o.value=!1,y&&(f.survey=y,U.value=!0)}return(y,g)=>(t(),p("div",Me,[(t(!0),p(m,null,h(v.value,(C,Q)=>(t(),n(ne,{key:Q,"model-value":C,onOnDelete:E=>s(Q),"onUpdate:modelValue":E=>D(E,Q),class:"q-mb-lg"},null,8,["model-value","onOnDelete","onUpdate:modelValue"]))),128)),l(H,{class:"bg-transparent",flat:""},{default:e(()=>[l(te,{class:"row q-pa-none"},{default:e(()=>[l(F,{onClick:g[0]||(g[0]=C=>_()),color:"secondary","text-color":"info",class:"col border-radius-8",padding:"md lg",style:{"line-height":"21px"},"no-caps":""},{default:e(()=>[d(" Добавить поле ")]),_:1}),l(F,{loading:o.value,onClick:B,color:"secondary","text-color":"positive",class:"col border-radius-8",padding:"md lg",style:{"line-height":"21px"},"no-caps":""},{default:e(()=>[d(" Сохранить анкету ")]),_:1},8,["loading"])]),_:1})]),_:1})]))}}),Pe=R(De,[["__file","SurveyEditMode.vue"]]),Oe=N({__name:"SurveyPage",setup(w){const b=W(),f=G(!0);return oe(b.loadPage),ve(()=>{b.isPageLoaded=!1}),(U,v)=>(t(),n(de,{class:"column items-center",padding:""},{default:e(()=>[q(b).isPageLoaded?(t(),n(fe,{key:0,name:"fade",mode:"out-in"},{default:e(()=>[f.value?(t(),n(he,{key:0,modelValue:f.value,"onUpdate:modelValue":v[0]||(v[0]=o=>f.value=o)},null,8,["modelValue"])):(t(),n(Pe,{key:1,modelValue:f.value,"onUpdate:modelValue":v[1]||(v[1]=o=>f.value=o)},null,8,["modelValue"]))]),_:1})):(t(),n(me,{key:1}))]),_:1}))}}),ze=R(Oe,[["__file","SurveyPage.vue"]]);export{ze as default};
