import{r as d,be as O,w as M,ad as S,a as U,s as w,ah as b,d as C,t as P,ac as R,ab as x,ag as D}from"./index-CE0I8MDv.js";import{r as F}from"./index-C79LVW5H.js";function L(t,e){const o=d(t);function v(l){return e[o.value][l]??o.value}return{state:o,dispatch:l=>{o.value=v(l)}}}function _(t,e){var g;const o=d({}),v=d("none"),h=d(t),l=t.value?"mounted":"unmounted";let c;const s=((g=e.value)==null?void 0:g.ownerDocument.defaultView)??O,{state:m,dispatch:u}=L(l,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}}),r=n=>{var a;if(b){const p=new CustomEvent(n,{bubbles:!1,cancelable:!1});(a=e.value)==null||a.dispatchEvent(p)}};M(t,async(n,a)=>{var A;const p=a!==n;if(await w(),p){const y=v.value,f=E(e.value);n?(u("MOUNT"),r("enter"),f==="none"&&r("after-enter")):f==="none"||f==="undefined"||((A=o.value)==null?void 0:A.display)==="none"?(u("UNMOUNT"),r("leave"),r("after-leave")):a&&y!==f?(u("ANIMATION_OUT"),r("leave")):(u("UNMOUNT"),r("after-leave"))}},{immediate:!0});const i=n=>{const a=E(e.value),p=a.includes(n.animationName),A=m.value==="mounted"?"enter":"leave";if(n.target===e.value&&p&&(r(`after-${A}`),u("ANIMATION_END"),!h.value)){const y=e.value.style.animationFillMode;e.value.style.animationFillMode="forwards",c=s==null?void 0:s.setTimeout(()=>{var f;((f=e.value)==null?void 0:f.style.animationFillMode)==="forwards"&&(e.value.style.animationFillMode=y)})}n.target===e.value&&a==="none"&&u("ANIMATION_END")},N=n=>{n.target===e.value&&(v.value=E(e.value))},T=M(e,(n,a)=>{n?(o.value=getComputedStyle(n),n.addEventListener("animationstart",N),n.addEventListener("animationcancel",i),n.addEventListener("animationend",i)):(u("ANIMATION_END"),c!==void 0&&(s==null||s.clearTimeout(c)),a==null||a.removeEventListener("animationstart",N),a==null||a.removeEventListener("animationcancel",i),a==null||a.removeEventListener("animationend",i))},{immediate:!0}),I=M(m,()=>{const n=E(e.value);v.value=m.value==="mounted"?n:"none"});return S(()=>{T(),I()}),{isPresent:U(()=>["mounted","unmountSuspended"].includes(m.value))}}function E(t){return t&&getComputedStyle(t).animationName||"none"}const V=C({name:"Presence",props:{present:{type:Boolean,required:!0},forceMount:{type:Boolean}},slots:{},setup(t,{slots:e,expose:o}){var u;const{present:v,forceMount:h}=P(t),l=d(),{isPresent:c}=_(v,l);o({present:c});let s=e.default({present:c.value});s=F(s||[]);const m=R();if(s&&(s==null?void 0:s.length)>1){const r=(u=m==null?void 0:m.parent)!=null&&u.type.name?`<${m.parent.type.name} />`:"component";throw new Error([`Detected an invalid children for \`${r}\` for  \`Presence\` component.`,"","Note: Presence works similarly to `v-if` directly, but it waits for animation/transition to finished before unmounting. So it expect only one direct child of valid VNode type.","You can apply a few solutions:",["Provide a single child element so that `presence` directive attach correctly.","Ensure the first child is an actual element instead of a raw text node or comment node."].map(i=>`  - ${i}`).join(`
`)].join(`
`))}return()=>h.value||v.value||c.value?x(e.default({present:c.value})[0],{ref:r=>{const i=D(r);return typeof(i==null?void 0:i.hasAttribute)>"u"||(i!=null&&i.hasAttribute("data-reka-popper-content-wrapper")?l.value=i.firstElementChild:l.value=i),i}}):null}});function q(){let t=document.activeElement;if(t==null)return null;for(;t!=null&&t.shadowRoot!=null&&t.shadowRoot.activeElement!=null;)t=t.shadowRoot.activeElement;return t}export{V as P,q as g};
