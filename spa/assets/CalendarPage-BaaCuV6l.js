import{u as K,Q as ae,a as oe,T as se}from"./TeamQuestionsModal-C8QN3T4T.js";import{Q as le}from"./QDrawer-olLkFS3T.js";import{Q as ne}from"./QToolbarTitle-CcdJFvIp.js";import{Q as re}from"./QToolbar-BMAiNFO6.js";import{Q as Y,a as v,b as m,c as b}from"./QItemLabel-DQHAnvuG.js";import{Q as ue}from"./format-RCdBGSCz.js";import{as as ie,A as p,d as z,r as L,c as O,p as ce,l as r,m as c,n as a,q as F,f as s,t as de,ag as D,P as g,x as H,U as pe,at as j,y as d,ai as U,ac as E,F as R,ad as J,ae as T,Q as X,a8 as me,a9 as Z,aa as fe,_ as ee,o as ge,E as ke,au as ve}from"./index-BlxHouq3.js";import{Q as _e}from"./QPage-AO4DD7ft.js";import{u as G,m as Q,Q as ye,C as w,a as be,I as Ce}from"./use-quasar-BaKaUcwM.js";import"./TouchPan-g40edDd4.js";const Se=ie("calendar",{state:()=>({workouts:{},isPageLoaded:!1}),actions:{async loadPage(){await this.loadCalendarData(),this.isPageLoaded=!0},async loadCalendarData(){const x=await p.getWorkouts();x&&(this.workouts=x.reduce((C,S)=>(C[S.id]=S,C),{}))}}}),te=Se,Te={class:"card-container card-container--sm bg-dark q-pa-md"},we={class:"text-h5 text-center"},Qe=z({__name:"CalendarModal",props:{actionType:{},workout:{}},emits:G.emits,setup(x){const C={start:"Начать тренировку",complete:"Завершить тренировку",cancel:"Отменить тренировку"},S={start:"positive",complete:"info",cancel:"negative"},V={start:[1,4],complete:[2,4],cancel:[2,4]},h=K(),u=te(),l=x,{dialogRef:i,onDialogOK:P,onDialogHide:A,onDialogCancel:B}=G(),k=L(!1),_=L({}),y=O(()=>h.team?l.workout.workoutType==="Групповая"?Object.values(h.groups[l.workout.groupId].sportsmans).map(o=>({label:Q(o),value:o.email,disable:W(o.id),status:_.value[o.id]?.status.description||null})):Object.values(h.team.sportsmans).map(o=>({label:Q(o),value:o.email,disable:W(o.id),status:_.value[o.id]?.status.description||null})):[]),f=L(y.value.map(o=>o.value)),$=O(()=>f.value.length===y.value.length);function q(o){f.value=o?y.value.map(e=>e.value):[]}function W(o){return _.value[o]?!V[l.actionType].includes(_.value[o].status.status):!0}async function N(){if(k.value=!0,$.value){const o=l.actionType==="start"?await p.startWorkout(l.workout.id):l.actionType==="complete"?await p.completeWorkout(l.workout.id):await p.cancelWorkout(l.workout.id);if(!o){k.value=!1;return}u.workouts[o.id]={...u.workouts[o.id],...o}}else{const o=l.actionType==="start"?await p.startWorkoutForList(l.workout.id,{sportsmansEmails:f.value}):l.actionType==="complete"?await p.completeWorkoutForList(l.workout.id,{sportsmansEmails:f.value}):await p.cancelWorkoutForList(l.workout.id,{sportsmansEmails:f.value});if(!o){k.value=!1;return}u.workouts[o.id]={...u.workouts[o.id],...o}}k.value=!1,P()}return ce(async()=>{const o=await p.getWorkoutStatuses(l.workout.id);if(!o){B();return}_.value=o.reduce((e,t)=>({...e,[t.sportsmanId]:t}),{})}),(o,e)=>(r(),c(fe,{onHide:Z(A),ref_key:"dialogRef",ref:i,"no-backdrop-dismiss":"","no-shake":""},{default:a(()=>[F("div",Te,[s(de,{class:"row items-center q-pb-md"},{default:a(()=>[F("div",we,D(C[o.actionType]),1),s(ye),g(s(H,{icon:"close",flat:"",round:"",dense:""},null,512),[[w]])]),_:1}),s(pe,{spaced:"lg"}),s(Y,{class:"q-my-md scroll",style:{"max-height":"calc(100vh - 24rem)"}},{default:a(()=>[g((r(),c(v,{tag:"label",class:"flex items-center q-py-none"},{default:a(()=>[s(m,{side:"",top:""},{default:a(()=>[s(j,{"model-value":$.value,"onUpdate:modelValue":q,color:"info"},null,8,["model-value"])]),_:1}),s(m,null,{default:a(()=>[s(b,null,{default:a(()=>[d("Все спортсмены")]),_:1})]),_:1})]),_:1})),[[U]]),(r(!0),E(R,null,J(y.value,t=>g((r(),c(v,{key:t.value,disable:t.disable,clickable:!t.disable,tag:"label",class:"flex items-center q-py-none"},{default:a(()=>[s(m,{side:"",top:""},{default:a(()=>[s(j,{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=n=>f.value=n),val:t.value,disable:t.disable,color:"info"},null,8,["modelValue","val","disable"])]),_:2},1024),s(m,null,{default:a(()=>[s(b,null,{default:a(()=>[d(D(t.label),1)]),_:2},1024),t.status?(r(),c(b,{key:0,caption:""},{default:a(()=>[d(D(t.status),1)]),_:2},1024)):T("",!0)]),_:2},1024)]),_:2},1032,["disable","clickable"])),[[U]])),128))]),_:1}),s(X,{class:"bg-transparent",flat:""},{default:a(()=>[s(me,{class:"row q-pa-none"},{default:a(()=>[s(H,{"text-color":S[o.actionType],onClick:N,color:"secondary",class:"col border-radius-8",padding:"md lg",style:{"line-height":"21px"},"no-caps":""},{default:a(()=>[d(" Применить ")]),_:1},8,["text-color"])]),_:1})]),_:1})])]),_:1},8,["onHide"]))}}),M=ee(Qe,[["__file","CalendarModal.vue"]]),De={key:0,class:"text-h5"},xe={key:1,class:"card-container column"},he=z({__name:"CalendarPage",setup(x){const C={1:{color:"primary",textColor:"dark"},2:{color:"info",textColor:"dark"},3:{color:"positive",textColor:"dark"},4:{color:"warning",textColor:"dark"},5:{color:"grey-5",textColor:"dark"},6:{color:"negative",textColor:"dark"}},S=[1,4],V=[2,4],h=[2,4],u=be(),l=te(),i=K(),P=L(!0);function A(e){const t=new Date(e);return`${t.getFullYear()}/${(t.getMonth()+1).toString().padStart(2,"0")}/${t.getDate().toString().padStart(2,"0")}`}function B(e){const t=new Date(e);return`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`}const k=L(A(new Date().toISOString().slice(0,-1))),_=O(()=>Object.values(l.workouts).map(e=>A(e.date))),y=O(()=>Object.values(l.workouts).filter(e=>A(e.date)===k.value));function f(e){if(i.team)return e.workoutType==="Командная"?"Командная тренировка":e.workoutType==="Групповая"?`Групповая тренировка (${i.groups[e.groupId].name})`:`Индивидуальная тренировка (${Q(i.team.sportsmans[e.sportsmanId])})`}function $(e){if(i.team){if(e.workoutType==="Индивидуальная"){u.dialog({title:"Начать тренировку?",message:`Вы уверены, что хотите начать тренировку ${Q(i.team.sportsmans[e.sportsmanId])}?`,persistent:!0,ok:{color:"secondary",label:"Начать",noCaps:!0},cancel:{color:"negative",label:"Отменить",noCaps:!0}}).onOk(async()=>{const t=await p.startWorkout(e.id);t&&(l.workouts[t.id]={...l.workouts[t.id],...t})});return}u.dialog({component:M,componentProps:{actionType:"start",workout:e}})}}function q(e){i.team&&u.dialog({title:"Удалить тренировку?",message:"Вы уверены, что хотите удалить тренировку?",persistent:!0,ok:{color:"negative",label:"Удалить",noCaps:!0},cancel:{color:"secondary",label:"Отменить",noCaps:!0}}).onOk(async()=>{await p.deleteWorkoutById(e.id)&&delete l.workouts[e.id]})}function W(e){if(i.team){if(e.workoutType==="Индивидуальная"){u.dialog({title:"Начать тренировку?",message:`Вы уверены, что хотите завершить тренировку ${Q(i.team.sportsmans[e.sportsmanId])}?`,persistent:!0,ok:{color:"secondary",label:"Завершить",noCaps:!0},cancel:{color:"negative",label:"Отменить",noCaps:!0}}).onOk(async()=>{const t=await p.completeWorkout(e.id);t&&(l.workouts[t.id]={...l.workouts[t.id],...t})});return}u.dialog({component:M,componentProps:{actionType:"complete",workout:e}})}}function N(e){if(i.team){if(e.workoutType==="Индивидуальная"){u.dialog({title:"Отменить тренировку?",message:`Вы уверены, что хотите отменить тренировку ${Q(i.team.sportsmans[e.sportsmanId])}?`,persistent:!0,ok:{color:"negative",label:"Отменить",noCaps:!0},cancel:{color:"secondary",label:"Отменить",noCaps:!0}}).onOk(async()=>{const t=await p.cancelWorkout(e.id);t&&(l.workouts[t.id]={...l.workouts[t.id],...t})});return}u.dialog({component:M,componentProps:{actionType:"cancel",workout:e}})}}function o(e){u.dialog({component:se,componentProps:{workoutId:e,type:"stress"}})}return ge(async()=>{await i.loadTeamData(),await l.loadPage()}),ke(()=>{l.isPageLoaded=!1}),(e,t)=>(r(),c(_e,{class:"flex items-center column overflow-hidden",padding:""},{default:a(()=>[Z(l).isPageLoaded?(r(),E(R,{key:0},[s(le,{modelValue:P.value,"onUpdate:modelValue":t[1]||(t[1]=n=>P.value=n),width:322,class:"column items-center q-pa-md bg-transparent"},{default:a(()=>[s(ae,{modelValue:k.value,"onUpdate:modelValue":t[0]||(t[0]=n=>k.value=n),events:_.value,"text-color":"dark","event-color":"info",class:"q-mb-md bg-secondary","no-unset":"","today-btn":"",flat:""},null,8,["modelValue","events"])]),_:1},8,["modelValue"]),s(re,{class:"bg-secondary text-white q-mb-md"},{default:a(()=>[s(ne,null,{default:a(()=>[d("Список тренировок")]),_:1})]),_:1}),y.value.length===0?(r(),E("div",De," Список тренировок пуст ")):(r(),E("div",xe,[(r(!0),E(R,null,J(y.value,n=>(r(),c(X,{key:n.id,class:"q-mb-md full-width bg-secondary",flat:""},{default:a(()=>[g((r(),c(v,{clickable:""},{default:a(()=>[s(m,null,{default:a(()=>[s(b,null,{default:a(()=>[d(D(n.name),1)]),_:2},1024),s(b,{caption:""},{default:a(()=>[d(D(f(n)),1)]),_:2},1024)]),_:2},1024),s(m,{side:""},{default:a(()=>[s(b,null,{default:a(()=>[s(oe,ve(C[n.status.status],{label:n.status.description}),null,16,["label"])]),_:2},1024),s(b,{caption:""},{default:a(()=>[d(D(B(n.date)),1)]),_:2},1024)]),_:2},1024),s(ue,{anchor:"bottom middle",self:"top middle"},{default:a(()=>[s(Y,null,{default:a(()=>[S.includes(n.status.status)?g((r(),c(v,{key:0,onClick:I=>$(n),clickable:""},{default:a(()=>[s(m,null,{default:a(()=>[d(" Начать тренировку ")]),_:1})]),_:2},1032,["onClick"])),[[w]]):T("",!0),n.status.status===1?g((r(),c(v,{key:1,onClick:I=>q(n),class:"text-red",clickable:""},{default:a(()=>[s(m,null,{default:a(()=>[d(" Удалить тренировку ")]),_:1})]),_:2},1032,["onClick"])),[[w]]):T("",!0),V.includes(n.status.status)?g((r(),c(v,{key:2,onClick:I=>W(n),class:"text-positive",clickable:""},{default:a(()=>[s(m,null,{default:a(()=>[d(" Завершить тренировку ")]),_:1})]),_:2},1032,["onClick"])),[[w]]):T("",!0),h.includes(n.status.status)?g((r(),c(v,{key:3,onClick:I=>N(n),class:"text-red",clickable:""},{default:a(()=>[s(m,null,{default:a(()=>[d(" Отменить тренировку ")]),_:1})]),_:2},1032,["onClick"])),[[w]]):T("",!0),n.status.status===3?g((r(),c(v,{key:4,onClick:I=>o(n.id),clickable:""},{default:a(()=>[s(m,null,{default:a(()=>[d("Нагрузочные опросники")]),_:1})]),_:2},1032,["onClick"])),[[w]]):T("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)),[[U]])]),_:2},1024))),128))]))],64)):(r(),c(Ce,{key:1}))]),_:1}))}}),qe=ee(he,[["__file","CalendarPage.vue"]]);export{qe as default};
