import{u as Y,Q as te,a as oe,T as se}from"./TeamQuestionsModal-DifCTh1m.js";import{a as le,Q as ne}from"./QDrawer-Bf1YBrQk.js";import{Q as re}from"./QToolbar-C8grvEH8.js";import{Q as G,a as v,b as m,c as b}from"./QList-DMvAb0PL.js";import{Q as ue}from"./QMenu-DDL4rfaS.js";import{aI as ie,a5 as p,d as J,r as L,c as O,D as ce,R as r,S as c,U as t,Y as F,f as s,a3 as de,ay as Q,ag as g,Q as H,X as pe,aJ as j,V as d,aA as U,au as E,F as R,av as X,aw as T,a2 as z,as as me,W as Z,at as fe,a0 as ee,o as ge,E as ke,aK as ve}from"./index-CrMxzk4B.js";import{Q as _e}from"./QPage-VYgDHi1e.js";import{u as K,m as D,Q as ye,C as w,a as be,I as Ce}from"./use-quasar-4RUW9YXV.js";import"./use-cache-hsIl6Ivw.js";import"./format-BoKE-3dj.js";const Se=ie("calendar",{state:()=>({workouts:{},isPageLoaded:!1}),actions:{async loadPage(){await this.loadCalendarData(),this.isPageLoaded=!0},async loadCalendarData(){const x=await p.getWorkouts();x&&(this.workouts=x.reduce((C,S)=>(C[S.id]=S,C),{}))}}}),ae=Se,Te={class:"card-container card-container--sm bg-dark q-pa-md"},we={class:"text-h5 text-center"},De=J({__name:"CalendarModal",props:{actionType:{},workout:{}},emits:K.emits,setup(x){const C={start:"Начать тренировку",complete:"Завершить тренировку",cancel:"Отменить тренировку"},S={start:"positive",complete:"info",cancel:"negative"},V={start:[1,4],complete:[2,4],cancel:[2,4]},h=Y(),u=ae(),l=x,{dialogRef:i,onDialogOK:W,onDialogHide:A,onDialogCancel:B}=K(),k=L(!1),_=L({}),y=O(()=>h.team?l.workout.workoutType==="Групповая"?Object.values(h.groups[l.workout.groupId].sportsmans).map(o=>({label:D(o),value:o.email,disable:I(o.id),status:_.value[o.id]?.status.description||null})):Object.values(h.team.sportsmans).map(o=>({label:D(o),value:o.email,disable:I(o.id),status:_.value[o.id]?.status.description||null})):[]),f=L(y.value.map(o=>o.value)),$=O(()=>f.value.length===y.value.length);function N(o){f.value=o?y.value.map(e=>e.value):[]}function I(o){return _.value[o]?!V[l.actionType].includes(_.value[o].status.status):!0}async function q(){if(k.value=!0,$.value){const o=l.actionType==="start"?await p.startWorkout(l.workout.id):l.actionType==="complete"?await p.completeWorkout(l.workout.id):await p.cancelWorkout(l.workout.id);if(!o){k.value=!1;return}u.workouts[o.id]={...u.workouts[o.id],...o}}else{const o=l.actionType==="start"?await p.startWorkoutForList(l.workout.id,{sportsmansEmails:f.value}):l.actionType==="complete"?await p.completeWorkoutForList(l.workout.id,{sportsmansEmails:f.value}):await p.cancelWorkoutForList(l.workout.id,{sportsmansEmails:f.value});if(!o){k.value=!1;return}u.workouts[o.id]={...u.workouts[o.id],...o}}k.value=!1,W()}return ce(async()=>{const o=await p.getWorkoutStatuses(l.workout.id);if(!o){B();return}_.value=o.reduce((e,a)=>({...e,[a.sportsmanId]:a}),{})}),(o,e)=>(r(),c(fe,{onHide:Z(A),ref_key:"dialogRef",ref:i,"no-backdrop-dismiss":"","no-shake":""},{default:t(()=>[F("div",Te,[s(de,{class:"row items-center q-pb-md"},{default:t(()=>[F("div",we,Q(C[o.actionType]),1),s(ye),g(s(H,{icon:"close",flat:"",round:"",dense:""},null,512),[[w]])]),_:1}),s(pe,{spaced:"lg"}),s(G,{class:"q-my-md scroll",style:{"max-height":"calc(100vh - 24rem)"}},{default:t(()=>[g((r(),c(v,{tag:"label",class:"flex items-center q-py-none"},{default:t(()=>[s(m,{side:"",top:""},{default:t(()=>[s(j,{"model-value":$.value,"onUpdate:modelValue":N,color:"info"},null,8,["model-value"])]),_:1}),s(m,null,{default:t(()=>[s(b,null,{default:t(()=>[d("Все спортсмены")]),_:1})]),_:1})]),_:1})),[[U]]),(r(!0),E(R,null,X(y.value,a=>g((r(),c(v,{key:a.value,disable:a.disable,clickable:!a.disable,tag:"label",class:"flex items-center q-py-none"},{default:t(()=>[s(m,{side:"",top:""},{default:t(()=>[s(j,{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=n=>f.value=n),val:a.value,disable:a.disable,color:"info"},null,8,["modelValue","val","disable"])]),_:2},1024),s(m,null,{default:t(()=>[s(b,null,{default:t(()=>[d(Q(a.label),1)]),_:2},1024),a.status?(r(),c(b,{key:0,caption:""},{default:t(()=>[d(Q(a.status),1)]),_:2},1024)):T("",!0)]),_:2},1024)]),_:2},1032,["disable","clickable"])),[[U]])),128))]),_:1}),s(z,{class:"bg-transparent",flat:""},{default:t(()=>[s(me,{class:"row q-pa-none"},{default:t(()=>[s(H,{"text-color":S[o.actionType],onClick:q,color:"secondary",class:"col border-radius-8",padding:"md lg",style:{"line-height":"21px"},"no-caps":""},{default:t(()=>[d(" Применить ")]),_:1},8,["text-color"])]),_:1})]),_:1})])]),_:1},8,["onHide"]))}}),M=ee(De,[["__file","CalendarModal.vue"]]),Qe={key:0,class:"text-h5"},xe={key:1,class:"card-container column"},he=J({__name:"CalendarPage",setup(x){const C={1:{color:"primary",textColor:"dark"},2:{color:"info",textColor:"dark"},3:{color:"positive",textColor:"dark"},4:{color:"warning",textColor:"dark"},5:{color:"grey-5",textColor:"dark"},6:{color:"negative",textColor:"dark"}},S=[1,4],V=[2,4],h=[2,4],u=be(),l=ae(),i=Y(),W=L(!0);function A(e){const a=new Date(e);return`${a.getFullYear()}/${(a.getMonth()+1).toString().padStart(2,"0")}/${a.getDate().toString().padStart(2,"0")}`}function B(e){const a=new Date(e);return`${a.getHours().toString().padStart(2,"0")}:${a.getMinutes().toString().padStart(2,"0")}`}const k=L(A(new Date().toISOString().slice(0,-1))),_=O(()=>Object.values(l.workouts).map(e=>A(e.date))),y=O(()=>Object.values(l.workouts).filter(e=>A(e.date)===k.value));function f(e){if(i.team)return e.workoutType==="Командная"?"Командная тренировка":e.workoutType==="Групповая"?`Групповая тренировка (${i.groups[e.groupId].name})`:`Индивидуальная тренировка (${D(i.team.sportsmans[e.sportsmanId])})`}function $(e){if(i.team){if(e.workoutType==="Индивидуальная"){u.dialog({title:"Начать тренировку?",message:`Вы уверены, что хотите начать тренировку ${D(i.team.sportsmans[e.sportsmanId])}?`,persistent:!0,ok:{color:"secondary",label:"Начать",noCaps:!0},cancel:{color:"negative",label:"Отменить",noCaps:!0}}).onOk(async()=>{const a=await p.startWorkout(e.id);a&&(l.workouts[a.id]={...l.workouts[a.id],...a})});return}u.dialog({component:M,componentProps:{actionType:"start",workout:e}})}}function N(e){i.team&&u.dialog({title:"Удалить тренировку?",message:"Вы уверены, что хотите удалить тренировку?",persistent:!0,ok:{color:"negative",label:"Удалить",noCaps:!0},cancel:{color:"secondary",label:"Отменить",noCaps:!0}}).onOk(async()=>{await p.deleteWorkoutById(e.id)&&delete l.workouts[e.id]})}function I(e){if(i.team){if(e.workoutType==="Индивидуальная"){u.dialog({title:"Начать тренировку?",message:`Вы уверены, что хотите завершить тренировку ${D(i.team.sportsmans[e.sportsmanId])}?`,persistent:!0,ok:{color:"secondary",label:"Завершить",noCaps:!0},cancel:{color:"negative",label:"Отменить",noCaps:!0}}).onOk(async()=>{const a=await p.completeWorkout(e.id);a&&(l.workouts[a.id]={...l.workouts[a.id],...a})});return}u.dialog({component:M,componentProps:{actionType:"complete",workout:e}})}}function q(e){if(i.team){if(e.workoutType==="Индивидуальная"){u.dialog({title:"Отменить тренировку?",message:`Вы уверены, что хотите отменить тренировку ${D(i.team.sportsmans[e.sportsmanId])}?`,persistent:!0,ok:{color:"negative",label:"Отменить",noCaps:!0},cancel:{color:"secondary",label:"Отменить",noCaps:!0}}).onOk(async()=>{const a=await p.cancelWorkout(e.id);a&&(l.workouts[a.id]={...l.workouts[a.id],...a})});return}u.dialog({component:M,componentProps:{actionType:"cancel",workout:e}})}}function o(e){u.dialog({component:se,componentProps:{workoutId:e,type:"stress"}})}return ge(async()=>{await i.loadTeamData(),await l.loadPage()}),ke(()=>{l.isPageLoaded=!1}),(e,a)=>(r(),c(_e,{class:"flex items-center column overflow-hidden",padding:""},{default:t(()=>[Z(l).isPageLoaded?(r(),E(R,{key:0},[s(le,{modelValue:W.value,"onUpdate:modelValue":a[1]||(a[1]=n=>W.value=n),width:322,class:"column items-center q-pa-md bg-transparent"},{default:t(()=>[s(te,{modelValue:k.value,"onUpdate:modelValue":a[0]||(a[0]=n=>k.value=n),events:_.value,"text-color":"dark","event-color":"info",class:"q-mb-md bg-secondary","no-unset":"","today-btn":"",flat:""},null,8,["modelValue","events"])]),_:1},8,["modelValue"]),s(re,{class:"bg-secondary text-white q-mb-md"},{default:t(()=>[s(ne,null,{default:t(()=>[d("Список тренировок")]),_:1})]),_:1}),y.value.length===0?(r(),E("div",Qe," Список тренировок пуст ")):(r(),E("div",xe,[(r(!0),E(R,null,X(y.value,n=>(r(),c(z,{key:n.id,class:"q-mb-md full-width bg-secondary",flat:""},{default:t(()=>[g((r(),c(v,{clickable:""},{default:t(()=>[s(m,null,{default:t(()=>[s(b,null,{default:t(()=>[d(Q(n.name),1)]),_:2},1024),s(b,{caption:""},{default:t(()=>[d(Q(f(n)),1)]),_:2},1024)]),_:2},1024),s(m,{side:""},{default:t(()=>[s(b,null,{default:t(()=>[s(oe,ve(C[n.status.status],{label:n.status.description}),null,16,["label"])]),_:2},1024),s(b,{caption:""},{default:t(()=>[d(Q(B(n.date)),1)]),_:2},1024)]),_:2},1024),s(ue,{anchor:"bottom middle",self:"top middle"},{default:t(()=>[s(G,null,{default:t(()=>[S.includes(n.status.status)?g((r(),c(v,{key:0,onClick:P=>$(n),clickable:""},{default:t(()=>[s(m,null,{default:t(()=>[d(" Начать тренировку ")]),_:1})]),_:2},1032,["onClick"])),[[w]]):T("",!0),n.status.status===1?g((r(),c(v,{key:1,onClick:P=>N(n),class:"text-red",clickable:""},{default:t(()=>[s(m,null,{default:t(()=>[d(" Удалить тренировку ")]),_:1})]),_:2},1032,["onClick"])),[[w]]):T("",!0),V.includes(n.status.status)?g((r(),c(v,{key:2,onClick:P=>I(n),class:"text-positive",clickable:""},{default:t(()=>[s(m,null,{default:t(()=>[d(" Завершить тренировку ")]),_:1})]),_:2},1032,["onClick"])),[[w]]):T("",!0),h.includes(n.status.status)?g((r(),c(v,{key:3,onClick:P=>q(n),class:"text-red",clickable:""},{default:t(()=>[s(m,null,{default:t(()=>[d(" Отменить тренировку ")]),_:1})]),_:2},1032,["onClick"])),[[w]]):T("",!0),n.status.status===3?g((r(),c(v,{key:4,onClick:P=>o(n.id),clickable:""},{default:t(()=>[s(m,null,{default:t(()=>[d("Нагрузочные опросники")]),_:1})]),_:2},1032,["onClick"])),[[w]]):T("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)),[[U]])]),_:2},1024))),128))]))],64)):(r(),c(Ce,{key:1}))]),_:1}))}}),Ne=ee(he,[["__file","CalendarPage.vue"]]);export{Ne as default};
