import{Q as oe}from"./QPage-VYgDHi1e.js";import{d as L,r as M,R as o,S as u,U as a,Y as P,f as l,a3 as Q,ag as Y,Q as b,X as O,a4 as I,au as V,F as h,av as E,a2 as j,as as X,V as y,W as R,at as ne,a0 as G,aV as z,aW as J,o as Z,a_ as K,aw as w,ay as D,az as A,aA as se,aU as ue,a5 as re,E as de,x as ie}from"./index-CrMxzk4B.js";import{u as H,a as T,Q as ce,C as pe,I as ve}from"./use-quasar-4RUW9YXV.js";import{u as ee,S as fe}from"./SurveyViewMode-Coq3U_jk.js";import{Q as me,c as ge}from"./QExpansionItem-D5ro2CRs.js";import{Q as ye,b as F,c as N,a as W}from"./QList-DMvAb0PL.js";import"./format-BoKE-3dj.js";import"./QMenu-DDL4rfaS.js";import"./rtl-DFPa-2ov.js";const be={class:"card-container bg-dark q-pa-md"},_e=P("div",{class:"text-h5 text-center"},"Редактирование группы",-1),ke={class:"scroll q-mb-lg",style:{"max-height":"calc(100vh - 16rem)"}},Ve=L({__name:"SurveyGroupModal",props:{group:{}},emits:H.emits,setup(S){const _=T(),d=S,{dialogRef:q,onDialogOK:r,onDialogHide:v}=H(),e=M(d.group);function x(){return Date.now().toString()}function $(){e.value.label||(e.value.label="Поле без названия")}function C(){e.value.fields.push({type:"text",key:x(),label:"Поле без названия",required:!1})}function U(p){_.dialog({title:"Удалить поле?",message:"Поле будет удалено без возможности восстановления",persistent:!0,ok:{color:"negative",label:"Удалить"},cancel:{color:"secondary",label:"Отменить"}}).onOk(()=>{e.value.fields.splice(p,1)})}function c(p,f){e.value.fields[f]=p}return(p,f)=>(o(),u(ne,{onHide:R(v),ref_key:"dialogRef",ref:q,"no-backdrop-dismiss":"","no-shake":""},{default:a(()=>[P("div",be,[l(Q,{class:"row items-center q-pb-md"},{default:a(()=>[_e,l(ce),Y(l(b,{icon:"close",flat:"",round:"",dense:""},null,512),[[pe]])]),_:1}),l(O,{spaced:"lg"}),P("div",ke,[l(I,{modelValue:e.value.label,"onUpdate:modelValue":f[0]||(f[0]=m=>e.value.label=m),onBlur:f[1]||(f[1]=m=>$()),label:"Название поля",placeholder:"Введите название группы",autofocus:"",outlined:""},null,8,["modelValue"]),(o(!0),V(h,null,E(e.value.fields,(m,k)=>(o(),u(le,{key:k,"model-value":m,"delete-unabled":e.value.fields.length===1,"onUpdate:modelValue":B=>c(B,k),onOnDelete:B=>U(k),class:"q-mt-lg","group-unabled":"","is-focused":""},null,8,["model-value","delete-unabled","onUpdate:modelValue","onOnDelete"]))),128))]),l(j,{class:"bg-transparent",flat:""},{default:a(()=>[l(X,{class:"row q-pa-none"},{default:a(()=>[l(b,{onClick:C,color:"secondary","text-color":"info",class:"col border-radius-8",padding:"md lg",style:{"line-height":"21px"},"no-caps":""},{default:a(()=>[y(" Добавить поле ")]),_:1}),l(b,{onClick:R(r),"text-color":"positive",color:"secondary",class:"col border-radius-8",padding:"md lg",style:{"line-height":"21px"},"no-caps":""},{default:a(()=>[y(" Применить ")]),_:1},8,["onClick"])]),_:1})]),_:1})])]),_:1},8,["onHide"]))}}),Se=G(Ve,[["__file","SurveyGroupModal.vue"]]),qe={class:"row items-center"},Ce={class:"row"},xe=L({__name:"SurveyEditCard",props:z({deleteUnabled:{type:Boolean,default:!1},groupUnabled:{type:Boolean,default:!1}},{modelValue:{required:!0},modelModifiers:{}}),emits:z(["onDelete"],["update:modelValue"]),setup(S,{emit:_}){const d={text:"Текстовое поле",number:"Числовое поле",select:"Один из списка",time:"Время",info:"Информационное поле",groups:"Группы полей"},q=T(),r=S,v=_,e=J(S,"modelValue"),x=M(!1);function $(){return r.groupUnabled?Object.entries(d).filter(([t])=>t!=="groups").map(([t,n])=>({value:t,label:n})):Object.entries(d).map(([t,n])=>({value:t,label:n}))}function C(){return Date.now().toString()}function U(){e.value.label||(e.value.label="Поле без названия")}function c(t){return t.type==="groups"||t.type==="info"?!1:t.required}function p(t){return`Вариант ${t+1}`}function f(t,n,s){t[s]=n}function m(t,n,s){return t.options.filter(g=>g===n).length>1&&t.options.findLastIndex(g=>g===n)===s}function k(t){q.dialog({component:Se,componentProps:{group:t}})}function B(){e.value.type==="groups"&&(e.value.groups.push({label:"Новая группа",fields:[{type:"text",key:C(),label:"Поле без названия",required:!1}]}),k(e.value.groups[e.value.groups.length-1]))}function ae(t){q.dialog({title:"Удалить группу?",message:"Группа будет удалена без возможности восстановления",persistent:!0,ok:{color:"negative",label:"Удалить"},cancel:{color:"secondary",label:"Отменить"}}).onOk(()=>{e.value.type==="groups"&&e.value.groups.splice(t,1)})}function te(t){switch(t){case"text":case"number":case"time":{e.value={type:t,key:C(),label:e.value.label,required:c(e.value)};break}case"select":{e.value={type:"select",key:C(),label:e.value.label,options:[p(0)],required:c(e.value)};break}case"info":{e.value={type:"info",label:e.value.label,value:"Без описания"};break}case"groups":{e.value={type:"groups",label:e.value.label,groups:[]};break}}}return Z(()=>{x.value=!0}),(t,n)=>(o(),u(j,{class:"border-radius-8",flat:""},{default:a(()=>[l(Q,{class:"row items-center justify-between"},{default:a(()=>[l(I,{modelValue:e.value.label,"onUpdate:modelValue":n[0]||(n[0]=s=>e.value.label=s),onBlur:n[1]||(n[1]=s=>U()),label:"Название поля",placeholder:"Введите название поля",class:"col q-mr-sm",style:{"min-width":"16rem"}},null,8,["modelValue"]),l(me,{"model-value":e.value.type,"onUpdate:modelValue":n[2]||(n[2]=s=>te(s)),options:$(),label:"Тип поля",class:"col q-ml-sm",style:{"min-width":"16rem"},"map-options":"","emit-value":"",outlined:""},null,8,["model-value","options"])]),_:1}),e.value.type==="select"?(o(),u(Q,{key:0,class:"q-pt-none"},{default:a(()=>[(o(!0),V(h,null,E(e.value.options,(s,g)=>(o(),V("div",{key:g,class:"row items-center q-mb-md"},[l(K,{"model-value":null,val:"",disable:""}),l(I,{"model-value":s,autofocus:x.value,error:m(e.value,s,g),"onUpdate:modelValue":i=>f(e.value.options,i,g),class:"q-ml-sm col","hide-bottom-space":"",dense:""},null,8,["model-value","autofocus","error","onUpdate:modelValue"]),e.value.options.length>1?(o(),u(b,{key:0,onClick:i=>e.value.options.splice(g,1),size:"sm",icon:"close",round:"",flat:""},null,8,["onClick"])):w("",!0)]))),128)),P("div",qe,[l(K,{"model-value":null,val:"",disable:""}),l(b,{onClick:n[3]||(n[3]=s=>e.value.options.push(p(e.value.options.length))),color:"primary",padding:"2px sm","no-caps":"",flat:""},{default:a(()=>[y(" Добавить вариант ")]),_:1})])]),_:1})):w("",!0),e.value.type==="info"?(o(),u(Q,{key:1,class:"q-pt-none"},{default:a(()=>[l(I,{modelValue:e.value.value,"onUpdate:modelValue":n[4]||(n[4]=s=>e.value.value=s),label:"Текст поля",placeholder:"Заполните поле"},null,8,["modelValue"])]),_:1})):w("",!0),e.value.type==="groups"?(o(),u(Q,{key:2,class:"q-py-none"},{default:a(()=>[e.value.groups.length>0?(o(),u(O,{key:0})):w("",!0),l(ye,{separator:""},{default:a(()=>[(o(!0),V(h,null,E(e.value.groups,(s,g)=>(o(),u(ge,{key:s.label,"header-inset-level":.3,"content-inset-level":.6},{header:a(()=>[l(F,null,{default:a(()=>[l(N,null,{default:a(()=>[y(D(s.label),1)]),_:2},1024)]),_:2},1024),l(F,{side:""},{default:a(()=>[P("div",Ce,[l(b,{onClick:A(i=>k(s),["stop"]),color:"positive",size:"sm",icon:"edit",round:"",flat:""},null,8,["onClick"]),l(b,{disable:e.value.groups.length===1,onClick:A(i=>ae(g),["stop"]),color:"negative",size:"sm",icon:"close",round:"",flat:""},null,8,["disable","onClick"])])]),_:2},1024)]),default:a(()=>[(o(!0),V(h,null,E(s.fields,i=>(o(),u(W,{key:i.label,class:"q-px-lg"},{default:a(()=>[l(F,null,{default:a(()=>[l(N,null,{default:a(()=>[y(D(i.label),1)]),_:2},1024),l(N,{caption:""},{default:a(()=>[y(D(d[i.type])+" "+D(i.type==="select"?`(${i.options.join(", ")})`:""),1)]),_:2},1024)]),_:2},1024),l(F,{side:""},{default:a(()=>[y(D(i.type==="info"?i.value:i.required?"Обязательное":"Необязательное"),1)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024))),128)),l(O),Y((o(),u(W,{onClick:B,class:"flex items-center text-info text-center",clickable:""},{default:a(()=>[l(F,null,{default:a(()=>[y(" Добавить группу ")]),_:1})]),_:1})),[[se]])]),_:1})]),_:1})):w("",!0),l(O,{inset:""}),l(Q,{class:"row justify-end"},{default:a(()=>[l(b,{disable:t.deleteUnabled,onClick:n[5]||(n[5]=s=>v("onDelete")),color:"negative",icon:"delete",round:"",flat:""},null,8,["disable"]),e.value.type!=="groups"&&e.value.type!=="info"?(o(),V(h,{key:0},[l(O,{vertical:"",spaced:""}),l(ue,{modelValue:e.value.required,"onUpdate:modelValue":n[6]||(n[6]=s=>e.value.required=s),label:"Обязательное поле","left-label":"",dense:""},null,8,["modelValue"])],64)):w("",!0)]),_:1})]),_:1}))}}),le=G(xe,[["__scopeId","data-v-143e26f2"],["__file","SurveyEditCard.vue"]]),we={class:"card-container column q-pa-md"},Qe=L({__name:"SurveyEditMode",props:{modelValue:{type:Boolean},modelModifiers:{}},emits:["update:modelValue"],setup(S){const _=T(),d=ee(),q=J(S,"modelValue"),r=M(d.survey?.addFields||[]),v=M(!1);function e(){return Date.now().toString()}function x(){r.value&&r.value.push({type:"text",key:e(),label:"Поле без названия",required:!1})}function $(c){_.dialog({title:"Удалить поле?",message:"Поле будет удалено без возможности восстановления",persistent:!0,ok:{color:"negative",label:"Удалить"},cancel:{color:"secondary",label:"Отменить"}}).onOk(()=>{r.value&&r.value.splice(c,1)})}function C(c,p){r.value[p]=c}async function U(){v.value=!0;const c=await re.updateSurvey({addFields:r.value});v.value=!1,c&&(d.survey=c,q.value=!0)}return(c,p)=>(o(),V("div",we,[(o(!0),V(h,null,E(r.value,(f,m)=>(o(),u(le,{key:m,"model-value":f,onOnDelete:k=>$(m),"onUpdate:modelValue":k=>C(k,m),class:"q-mb-lg"},null,8,["model-value","onOnDelete","onUpdate:modelValue"]))),128)),l(j,{class:"bg-transparent",flat:""},{default:a(()=>[l(X,{class:"row q-pa-none"},{default:a(()=>[l(b,{onClick:p[0]||(p[0]=f=>x()),color:"secondary","text-color":"info",class:"col border-radius-8",padding:"md lg",style:{"line-height":"21px"},"no-caps":""},{default:a(()=>[y(" Добавить поле ")]),_:1}),l(b,{loading:v.value,onClick:U,color:"secondary","text-color":"positive",class:"col border-radius-8",padding:"md lg",style:{"line-height":"21px"},"no-caps":""},{default:a(()=>[y(" Сохранить анкету ")]),_:1},8,["loading"])]),_:1})]),_:1})]))}}),he=G(Qe,[["__file","SurveyEditMode.vue"]]),$e=L({__name:"SurveyPage",setup(S){const _=ee(),d=M(!0);return Z(_.loadPage),de(()=>{_.isPageLoaded=!1}),(q,r)=>(o(),u(oe,{class:"column items-center",padding:""},{default:a(()=>[R(_).isPageLoaded?(o(),u(ie,{key:0,name:"fade",mode:"out-in"},{default:a(()=>[d.value?(o(),u(fe,{key:0,modelValue:d.value,"onUpdate:modelValue":r[0]||(r[0]=v=>d.value=v)},null,8,["modelValue"])):(o(),u(he,{key:1,modelValue:d.value,"onUpdate:modelValue":r[1]||(r[1]=v=>d.value=v)},null,8,["modelValue"]))]),_:1})):(o(),u(ve,{key:1}))]),_:1}))}}),Le=G($e,[["__file","SurveyPage.vue"]]);export{Le as default};
